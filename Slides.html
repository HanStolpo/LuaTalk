<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Handré Stolp" />
  <title>Introduction to Lua the Extensible Extension Language</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="http://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script src="http://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js.gz"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Introduction to Lua the Extensible Extension Language</h1>
  <p class="author">
Handré Stolp
  </p>
  <p class="date">8th April 2013</p>
</div>
<div class="section titleslide slide level1" id="introduction"><h1>Introduction</h1></div><div class="section slide level2" id="what-is-lua">
<h1>What is Lua</h1>
<ul class="incremental">
<li>It is an embeddable scripting language</li>
<li>It is dynamically typed</li>
<li>It runs on a register-based virtual machine</li>
<li>It has automatic memory management with incremental GC</li>
<li>It has simple procedural <em>C</em> and <em>Pascal</em> like syntax</li>
<li>It has good support for functional and declarative paradigms
<ul class="incremental">
<li>Functions are first class objects</li>
<li>Lexically scoped closures</li>
<li>Tail recursion</li>
</ul></li>
<li>Its is portable and minimalist
<ul class="incremental">
<li>Portable ANSI C</li>
<li>Does not come with batteries</li>
<li>Can squeeze runtime and standard libraries into approximately 98 KB</li>
</ul></li>
</ul>
</div>
<div class="section titleslide slide level1" id="the-language"><h1>The Language</h1></div><div class="section slide level2" id="comments">
<h1>Comments</h1>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is a single line comment</span>
<span class="co">--[[ This is a multiline </span>
<span class="co">     comment</span>
<span class="co">--]]</span>
<span class="co">--[=[ This is a multiline </span>
<span class="co">     comment</span>
<span class="co">    --[[ </span>
<span class="co">        With a nested multiline </span>
<span class="co">        comment</span>
<span class="co">    --]]</span>

<span class="co">    Any amount of `=` allowed the start and end count must just match</span>
<span class="co">--]=]</span></code></pre>
</div><div class="section slide level2" id="statements">
<h1>Statements</h1>
<ul class="incremental">
<li><p>Each line is a new statement and default scope is global</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">a</span> <span class="ot">=</span> <span class="dv">1</span>       <span class="co">-- global variable </span>
<span class="kw">local</span> <span class="kw">b</span> <span class="ot">=</span> <span class="dv">2</span> <span class="co">-- prepend with &#39;local&#39; to bind to lexical scope</span></code></pre></li>
<li><p>Standard standard <em>C</em> and <em>Pascal</em> like binary operators</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">+</span> <span class="kw">b</span>       <span class="co">-- add</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">-</span> <span class="kw">b</span>       <span class="co">-- subtract</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">*</span> <span class="kw">b</span>       <span class="co">-- multiply</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> % <span class="kw">b</span>       <span class="co">-- modulus</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">^</span> <span class="kw">b</span>       <span class="co">-- a to power b</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">==</span> <span class="kw">b</span>      <span class="co">-- equality</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">~=</span> <span class="kw">b</span>      <span class="co">-- inequality</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">&lt;</span> <span class="kw">b</span>       <span class="co">-- less than</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">&gt;</span> <span class="kw">b</span>       <span class="co">-- greater than</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">&lt;=</span> <span class="kw">b</span>      <span class="co">-- less than equal</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">&gt;=</span> <span class="kw">b</span><span class="ot">;</span>     <span class="co">-- greater than equal</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="st">&quot;ss&quot;</span> <span class="ot">..</span> <span class="st">&quot;XX&quot;</span><span class="co">-- string concatenation</span></code></pre></li>
</ul>
</div><div class="section slide level2" id="statements-continued">
<h1>Statements continued</h1>
<ul class="incremental">
<li><p>Multiple assignment supported and multiple statements per line separated by <strong>;</strong></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">a</span><span class="ot">,</span> <span class="kw">b</span> <span class="ot">=</span> <span class="kw">b</span><span class="ot">,</span> <span class="kw">a</span>         <span class="co">-- this swaps the values of a and b</span>
<span class="kw">local</span> <span class="kw">c</span> <span class="ot">=</span> <span class="dv">3</span><span class="ot">;</span> <span class="kw">d</span> <span class="ot">=</span> <span class="dv">4</span><span class="ot">;</span> <span class="co">-- multiple statements per line</span>
<span class="co">-- define local variable e with no value bound to it</span>
<span class="kw">local</span> <span class="kw">e</span><span class="ot">;</span>            <span class="co">-- &#39;;&#39; not necessary but OK.</span></code></pre></li>
<li><p>Logical operators a bit different (<strong>nil</strong> and <strong>false</strong> is false everything else is true)</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- stops on false or nil , returns last evaluated value</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="kw">and</span> <span class="kw">b</span>         <span class="co">-- if a true then b else false</span>
<span class="co">-- stops on true (not false or nil ), returns last evaluated value</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">a</span> <span class="kw">or</span> <span class="kw">b</span>          <span class="co">-- if a true then a else b</span>
<span class="co">-- Logically invert </span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">not</span> <span class="kw">a</span>           <span class="co">-- if a true then true else false</span>
<span class="co">-- using and and or for conditional assignment</span>
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">IAmNotDefined</span> <span class="kw">or</span> <span class="st">&#39;So default value&#39;</span> 
<span class="kw">e</span> <span class="ot">=</span> <span class="kw">e</span> <span class="kw">and</span> <span class="kw">IAmNotDefinedButDoesntMatter</span></code></pre></li>
</ul>
</div><div class="section slide level2" id="types">
<h1>Types</h1>
<p>All values in Lua are <em>first-class</em> (stored in variables; passed as arguments; returned as results)</p>
<dl class="incremental">
<dt>nil</dt>
<dd>The bottom type signifying nothing
</dd>
<dt>boolean</dt>
<dd>The logical type can either be <code>true</code> or <code>false</code>.
</dd>
<dd><code>nil</code> and <code>false</code> counts as false everything else is true.
</dd>
<dt>number</dt>
<dd>The only arithmetic type.
</dd>
<dd>Runtime dependant usually <code>double</code> (could be <code>char</code>, <code>short</code>, <code>int</code>, <code>float</code>).
</dd>
<dt>string</dt>
<dd>Immutable array of 8-bit <code>char</code> values.
</dd>
<dd>8-bit clean i.e. may include embedded zeros <code>'\0'</code>
</dd>
</dl>
</div><div class="section slide level2" id="types-continued">
<h1>Types continued</h1>
<dl class="incremental">
<dt>function</dt>
<dd>Any function defined in <em>Lua</em>
</dd>
<dd>Any function defined in <em>C</em> and exposed to <em>Lua</em>
</dd>
<dd>Any compiled file or string of <em>Lua</em> statements
</dd>
<dt>thread</dt>
<dd>Represents independent thread of execution.
</dd>
<dd>Not <em>OS</em> threads used for coroutines
</dd>
<dt>userdata</dt>
<dd>Arbitrary <em>C</em> data to be stored in <em>Lua</em>
</dd>
<dd>Only operations are assignment and identity test
</dd>
<dt>table</dt>
<dd>The only data structure in <em>Lua</em>
</dd>
<dd>Associative arrays
</dd>
<dd>Heterogeneous in value and key (any type except <code>nil</code>)
</dd>
</dl>
</div><div class="section slide level2" id="strings">
<h1>Strings</h1>
<ul class="incremental">
<li>Escaped strings
<ul class="incremental">
<li><code>'Some\n &quot;blah&quot; string'</code> don't need to escape <code>&quot;</code></li>
<li><code>&quot;Some\n 'blah' string&quot;</code> don't need to escape <code>'</code></li>
</ul></li>
<li><p>Literal strings</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">someString</span> <span class="ot">=</span> <span class="st">[[</span>
<span class="st">first new line is ignored</span>
<span class="st">this is a new line but this </span><span class="ot">\n</span><span class="st"> is not</span>
<span class="st">]]</span>

<span class="st">local anotherString = [=[the string does not end here]]</span>
<span class="st">[[some text]]</span>
<span class="st">the string ends here]=]</span></code></pre></li>
</ul>
</div><div class="section slide level2" id="tables">
<h1>Tables</h1>
<ul class="incremental">
<li><p>Indexing</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">a</span> <span class="ot">=</span> <span class="kw">t</span><span class="ot">[</span><span class="dv">1</span><span class="ot">]</span>        <span class="co">-- access array element 1</span>
<span class="kw">a</span> <span class="ot">=</span> <span class="kw">t</span><span class="ot">[</span><span class="st">&#39;blah&#39;</span><span class="ot">]</span>   <span class="co">-- access element string key &#39;blah&#39;</span>
<span class="kw">a</span> <span class="ot">=</span> <span class="kw">t</span><span class="ot">.</span><span class="kw">blah</span>      <span class="co">-- syntactic sugar for t[&#39;blah&#39;]</span></code></pre></li>
<li><p>Constructors</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- empty table</span>
<span class="kw">t</span> <span class="ot">=</span> <span class="ot">{}</span>

<span class="co">-- simple array elements are t[1], t[2], t[3]</span>
<span class="kw">t</span> <span class="ot">=</span> <span class="ot">{</span><span class="st">&quot;blah&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="kw">true</span><span class="ot">}</span>

<span class="co">-- simple map elements t[&#39;blah&#39;], t[&#39;foo&#39;]</span>
<span class="kw">t</span> <span class="ot">=</span> <span class="ot">{</span><span class="kw">blah</span> <span class="ot">=</span> <span class="dv">5</span><span class="ot">,</span> <span class="kw">foo</span><span class="ot">=</span><span class="kw">true</span><span class="ot">}</span>

<span class="co">-- Explicit keys</span>
<span class="kw">t</span> <span class="ot">=</span> <span class="ot">{[</span><span class="st">&#39;blah&#39;</span><span class="ot">]</span> <span class="ot">=</span> <span class="dv">5</span><span class="ot">,</span> <span class="ot">[</span><span class="dv">100</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">true</span><span class="ot">}</span>

<span class="co">-- mixed elements at t[1], t[2], t[100], t.foo t.bar</span>
<span class="kw">t</span> <span class="ot">=</span> 
<span class="ot">{</span>   <span class="st">&#39;alpha&#39;</span><span class="ot">,</span> <span class="st">&#39;bravo&#39;</span><span class="ot">;</span>   <span class="co">-- element separator either , or ;</span>
    <span class="kw">foo</span> <span class="ot">=</span> <span class="dv">5</span><span class="ot">;</span> <span class="kw">bar</span><span class="ot">=</span><span class="dv">4</span>
    <span class="ot">[</span><span class="dv">100</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">false</span><span class="ot">,</span>
<span class="ot">}</span></code></pre></li>
<li><p>Insertion and deletion</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">t</span><span class="ot">.</span><span class="kw">foo</span> <span class="ot">=</span> <span class="dv">5</span>   <span class="co">-- Insert value 5 at key foo</span>
<span class="kw">t</span><span class="ot">.</span><span class="kw">foo</span> <span class="ot">=</span> <span class="kw">nil</span> <span class="co">-- Delete key foo from table</span></code></pre></li>
</ul>
</div><div class="section slide level2" id="functions">
<h1>Functions</h1>
<ul class="incremental">
<li>All functions have an environment
<ul class="incremental">
<li>The environment is a Lua table</li>
<li>Global write inserts into the table</li>
<li>Global read performs table lookup</li>
<li>Local values shadow global values</li>
</ul></li>
<li>A Lua file is actually a function</li>
<li><p>Function definition</p>
<pre class="sourceCode lua"><code class="sourceCode lua">    <span class="kw">function</span> <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="kw">end</span></code></pre>
<ul class="incremental">
<li>Start function scope with keyword <code>function</code></li>
<li>Follow it with argument list <code>(a1, a2, ...)</code></li>
<li>End function scope with keyword <code>end</code></li>
<li>All statements between start and end are in function scope</li>
<li>Optional keyword <code>return</code> returns functions result</li>
</ul></li>
<li><p>Global function assignment</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is syntax sugar</span>
<span class="kw">function</span> arb <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="kw">end</span>
<span class="co">-- for this assignment of a function to the global &#39;arb&#39;</span>
<span class="kw">arb</span> <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="kw">end</span> </code></pre></li>
<li><p>Local function assignment</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is syntax sugar</span>
<span class="kw">local</span> <span class="kw">function</span> arb <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="kw">end</span>
<span class="co">-- for this assignment of a function to the local &#39;arb&#39;</span>
<span class="kw">local</span> <span class="kw">arb</span> <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="kw">end</span> </code></pre></li>
</ul>
</div><div class="section slide level2" id="functions-continued">
<h1>Functions continued</h1>
<ul class="incremental">
<li><p>Table function insertion</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is syntax sugar</span>
<span class="kw">function</span> <span class="kw">t</span><span class="ot">.</span>arb <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="kw">end</span>
<span class="co">-- for this insertion of a function into table t at key arb</span>
<span class="kw">t</span><span class="ot">[</span><span class="st">&#39;arb&#39;</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="kw">end</span></code></pre></li>
<li><p>Table function insertion with implicit <code>self</code></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is syntax sugar</span>
<span class="kw">function</span> <span class="kw">t</span>:arb <span class="ot">(</span><span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> 
    <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="ot">+</span> <span class="kw">self</span><span class="ot">[</span><span class="dv">1</span><span class="ot">]</span>
<span class="kw">end</span>
<span class="co">-- for this insertion of a function into table t at key arb</span>
<span class="co">-- and implicit self parameter</span>
<span class="kw">t</span><span class="ot">[</span><span class="st">&#39;arb&#39;</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">self</span><span class="ot">,</span> <span class="kw">arg1</span><span class="ot">,</span> <span class="kw">arg2</span><span class="ot">)</span> 
    <span class="kw">return</span> <span class="kw">arg1</span> <span class="ot">+</span> <span class="kw">arg2</span> <span class="ot">+</span> <span class="kw">self</span><span class="ot">[</span><span class="dv">1</span><span class="ot">]</span>
<span class="kw">end</span></code></pre></li>
<li><p>Function called by applying argument list to function value</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">arb</span> <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">a</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">a</span> <span class="ot">+</span> <span class="kw">a</span> <span class="kw">end</span>
<span class="kw">local</span> <span class="kw">x</span> <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>    <span class="co">-- x is 4</span></code></pre></li>
<li><p>Calling function implicitly passing <code>self</code></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">t</span> <span class="ot">=</span> <span class="ot">{</span>
    <span class="kw">arb</span> <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span><span class="kw">self</span><span class="ot">,</span> <span class="kw">a</span><span class="ot">)</span> 
        <span class="kw">return</span> <span class="kw">self</span><span class="ot">.</span><span class="kw">x</span> <span class="ot">+</span> <span class="kw">a</span> 
    <span class="kw">end</span><span class="ot">;</span> 
    <span class="kw">x</span> <span class="ot">=</span> <span class="dv">1</span><span class="ot">;</span> <span class="co">-- trailing delimiter is fine</span>
<span class="ot">}</span>
<span class="co">-- This is syntax sugar for </span>
<span class="kw">local</span> <span class="kw">b</span> <span class="ot">=</span> <span class="kw">t</span>:arb<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>
<span class="co">-- this lookup of arb in t and passing it t and 2</span>
<span class="kw">local</span> <span class="kw">c</span> <span class="ot">=</span> <span class="kw">t</span><span class="ot">.</span>arb<span class="ot">(</span><span class="kw">t</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span></code></pre></li>
</ul>
</div><div class="section slide level2" id="functions-continued-1">
<h1>Functions continued</h1>
<ul class="incremental">
<li><p>Parentheses optional when calling function with literal string</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is syntax sugar</span>
<span class="fu">print</span> <span class="st">&quot;blah&quot;</span>
<span class="co">-- for this</span>
<span class="fu">print</span><span class="ot">(</span><span class="st">&quot;blah&quot;</span><span class="ot">)</span></code></pre></li>
<li><p>Parentheses optional when calling function with table constructor</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is syntax sugar</span>
<span class="fu">ipairs</span> <span class="ot">{</span><span class="dv">1</span><span class="ot">,</span><span class="dv">2</span><span class="ot">,</span><span class="dv">3</span><span class="ot">,</span><span class="dv">4</span><span class="ot">}</span>
<span class="co">-- for this</span>
<span class="fu">ipairs</span> <span class="ot">({</span><span class="dv">1</span><span class="ot">,</span><span class="dv">2</span><span class="ot">,</span><span class="dv">3</span><span class="ot">,</span><span class="dv">4</span><span class="ot">})</span></code></pre></li>
<li><p>Function return types are dynamic</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">function</span> arb<span class="ot">(</span><span class="kw">x</span><span class="ot">)</span>
    <span class="kw">if</span>      <span class="kw">x</span> <span class="ot">==</span> <span class="dv">1</span>      <span class="kw">then</span>   <span class="kw">return</span> <span class="dv">3</span><span class="ot">,</span><span class="dv">4</span>
    <span class="kw">elseif</span>  <span class="kw">x</span> <span class="ot">==</span> <span class="st">&#39;j&#39;</span>    <span class="kw">then</span>   <span class="kw">return</span> <span class="st">&#39;bob&#39;</span><span class="ot">,</span><span class="dv">8</span>
    <span class="kw">elseif</span>  <span class="kw">x</span> <span class="ot">==</span> <span class="st">&#39;m&#39;</span>    <span class="kw">then</span>   <span class="kw">return</span> <span class="kw">nil</span><span class="ot">,</span><span class="st">&#39;s&#39;</span>
    <span class="kw">elseif</span>  <span class="kw">x</span> <span class="ot">==</span> <span class="dv">2</span>      <span class="kw">then</span>   <span class="kw">return</span> <span class="dv">4</span>
    <span class="kw">else</span>
        <span class="co">-- returning nothing</span>
    <span class="kw">end</span>
<span class="kw">end</span>
<span class="kw">a</span><span class="ot">,</span><span class="kw">b</span> <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">1</span><span class="ot">)</span>    <span class="co">-- a == 3, b == 4</span>
<span class="kw">a</span><span class="ot">,</span><span class="kw">b</span> <span class="ot">=</span> arb<span class="ot">(</span><span class="st">&#39;j&#39;</span><span class="ot">)</span>  <span class="co">-- a == &#39;bob&#39;, b == 8</span>
<span class="kw">a</span><span class="ot">,</span><span class="kw">b</span> <span class="ot">=</span> arb<span class="ot">(</span><span class="st">&#39;m&#39;</span><span class="ot">)</span>  <span class="co">-- a == nil, b == &#39;s&#39;</span>
<span class="kw">a</span><span class="ot">,</span><span class="kw">b</span> <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>    <span class="co">-- a == 4, b == nil</span>
<span class="kw">a</span><span class="ot">,</span><span class="kw">b</span> <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">3</span><span class="ot">)</span>    <span class="co">-- a == nil, b == nil</span></code></pre></li>
</ul>
</div><div class="section slide level2" id="functions-continued-2">
<h1>Functions continued</h1>
<ul class="incremental">
<li><p>Functions support closures</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">function</span> makeCounter<span class="ot">()</span>
    <span class="kw">local</span> <span class="kw">count</span> <span class="ot">=</span> <span class="ot">-</span><span class="dv">1</span>            <span class="co">-- local variable</span>
    <span class="kw">return</span> <span class="kw">function</span> <span class="ot">()</span>          <span class="co">-- return the function</span>
        <span class="co">-- capture `count` updating on each invocation</span>
        <span class="kw">return</span> <span class="kw">count</span> <span class="ot">=</span> <span class="kw">count</span> <span class="ot">+</span> <span class="dv">1</span>
    <span class="kw">end</span>
<span class="kw">end</span>
<span class="kw">local</span> <span class="kw">c1</span> <span class="ot">=</span> makeCounter<span class="ot">()</span>
<span class="kw">local</span> <span class="kw">_1</span><span class="ot">,</span> <span class="kw">_2</span><span class="ot">,</span> <span class="kw">_3</span> <span class="ot">=</span> c1<span class="ot">(),</span> c1<span class="ot">(),</span> c1<span class="ot">()</span> <span class="co">-- _1 == 0, _2 == 1, _3 == 2</span>
<span class="kw">local</span> <span class="kw">c2</span> <span class="ot">=</span> makeCounter<span class="ot">()</span>
<span class="kw">_1</span><span class="ot">,</span> <span class="kw">_2</span><span class="ot">,</span> <span class="kw">_3</span> <span class="ot">=</span> c2<span class="ot">(),</span> c1<span class="ot">(),</span> c2<span class="ot">()</span>       <span class="co">-- _1 == 0, _2 == 4, _3 == 1</span></code></pre></li>
<li><p>Functions support tail call recursion</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">function</span> fib<span class="ot">(</span><span class="kw">n</span><span class="ot">)</span>
    <span class="kw">local</span> _fib<span class="ot">(</span><span class="kw">fn2</span><span class="ot">,</span> <span class="kw">fn1</span><span class="ot">,</span> <span class="kw">at</span><span class="ot">)</span>
        <span class="kw">if</span> <span class="kw">at</span> <span class="ot">==</span> <span class="kw">n</span> <span class="kw">then</span> 
            <span class="kw">return</span> <span class="kw">fn1</span> <span class="ot">+</span> <span class="kw">fn2</span>
        <span class="kw">else</span>
            <span class="kw">return</span> _fib<span class="ot">(</span><span class="kw">fn1</span><span class="ot">,</span> <span class="kw">fn1</span> <span class="ot">+</span> <span class="kw">fn2</span><span class="ot">,</span> <span class="kw">at</span><span class="ot">+</span><span class="dv">1</span><span class="ot">)</span>
        <span class="kw">end</span>
    <span class="kw">end</span>
    <span class="kw">if</span> <span class="kw">n</span> <span class="ot">&lt;=</span> <span class="dv">0</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">0</span>
    <span class="kw">elseif</span> <span class="kw">n</span> <span class="ot">==</span> <span class="dv">1</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">1</span>
    <span class="kw">else</span> <span class="kw">return</span> _fib<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span>
<span class="kw">end</span>
<span class="co">-- no stack overflow</span>
<span class="kw">local</span> <span class="kw">c</span> <span class="ot">=</span> fib<span class="ot">(</span><span class="dv">10000</span><span class="ot">)</span></code></pre></li>
</ul>
</div><div class="section slide level2" id="control-structures">
<h1>Control structures</h1>
<dl class="incremental">
<dt>do block end</dt>
<dd><p>Introduces local scope</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">do</span>
    <span class="kw">local</span> <span class="kw">onlyVisibleHere</span> <span class="ot">=</span> <span class="dv">5</span>
<span class="kw">end</span></code></pre>
</dd>
<dt>if then else</dt>
<dd><p>Conditional branching with each branch introducing a local scope.</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">if</span> <span class="kw">a</span> <span class="ot">==</span> <span class="kw">b</span> <span class="kw">then</span>      <span class="co">-- start if branch</span>
    <span class="kw">e</span> <span class="ot">=</span> <span class="dv">2</span>
<span class="kw">elseif</span> <span class="kw">a</span> <span class="ot">==</span> <span class="kw">c</span> <span class="kw">then</span>  <span class="co">-- optional else if branch</span>
    <span class="kw">e</span> <span class="ot">=</span> <span class="dv">3</span> 
<span class="kw">else</span>                <span class="co">-- optional else branch</span>
    <span class="kw">e</span> <span class="ot">=</span> <span class="dv">4</span>
<span class="kw">end</span>                 <span class="co">-- required terminator</span></code></pre>
</dd>
</dl>
</div><div class="section slide level2" id="control-structures-continued">
<h1>Control structures continued</h1>
<dl class="incremental">
<dt>while</dt>
<dd><p>If condition is true then repeatedly execute block until false</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">a</span><span class="ot">,</span><span class="kw">b</span> <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span><span class="dv">5</span>
<span class="kw">while</span> <span class="kw">a</span> <span class="ot">&lt;</span> <span class="kw">b</span> <span class="kw">do</span>
    <span class="kw">a</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">+</span> <span class="dv">1</span>       <span class="co">-- executes 4 times</span>
<span class="kw">end</span></code></pre>
</dd>
<dt>repeat</dt>
<dd><p>Execute block and if condition is true repeat until false</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">a</span><span class="ot">,</span><span class="kw">b</span> <span class="ot">=</span> <span class="dv">4</span><span class="ot">,</span><span class="dv">5</span>
<span class="kw">repeat</span>
   <span class="kw">a</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">+</span> <span class="dv">1</span>        <span class="co">-- executes 2 times</span>
<span class="kw">until</span> <span class="kw">a</span> <span class="ot">==</span> <span class="kw">b</span></code></pre>
</dd>
<dt>break</dt>
<dd><p>Forces enclosing looping structure to terminate immediately</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">a</span> <span class="ot">=</span> <span class="dv">1</span>
<span class="kw">while</span> <span class="kw">true</span> <span class="kw">do</span>
    <span class="kw">break</span>
    <span class="kw">a</span> <span class="ot">=</span> <span class="kw">a</span> <span class="ot">+</span> <span class="dv">1</span>       <span class="co">-- never executes a remains 1</span>
<span class="kw">end</span></code></pre>
</dd>
</dl>
</div><div class="section slide level2" id="control-structures-continued-1">
<h1>Control structures continued</h1>
<dl class="incremental">
<dt>numerical for</dt>
<dd><p>Repeat the block until initial value passes limit incrementing by optional step size. Default step size is 1.</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">a</span> <span class="ot">=</span> <span class="dv">1</span>
<span class="kw">for</span> <span class="kw">u</span><span class="ot">=</span><span class="dv">1</span><span class="ot">,</span><span class="dv">10</span> <span class="kw">do</span>
    <span class="kw">a</span> <span class="ot">=</span> <span class="kw">u</span>       <span class="co">-- executes 10 times (at end a == 10)</span>
<span class="kw">end</span>
<span class="kw">for</span> <span class="kw">u</span><span class="ot">=</span><span class="dv">10</span><span class="ot">,</span><span class="dv">1</span><span class="ot">,-</span><span class="dv">1</span> <span class="kw">do</span>
    <span class="kw">a</span> <span class="ot">=</span> <span class="kw">u</span>       <span class="co">-- executes 10 times (at end a == 1)</span>
<span class="kw">end</span></code></pre>
</dd>
<dt>generic for</dt>
<dd><p>The generic for loop works over functions called iterators. On each iteration, the iterator function is called to produce a new value, stopping when this new value is nil.</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">a</span> <span class="ot">=</span> <span class="dv">1</span>
<span class="kw">for</span> <span class="kw">k</span><span class="ot">,</span><span class="kw">v</span> <span class="kw">in</span> <span class="fu">ipairs</span> <span class="ot">{</span><span class="dv">0</span><span class="ot">,</span><span class="dv">1</span><span class="ot">,</span><span class="dv">2</span><span class="ot">,</span><span class="dv">3</span><span class="ot">,</span><span class="dv">4</span><span class="ot">,</span><span class="dv">5</span><span class="ot">,</span><span class="dv">6</span><span class="ot">,</span><span class="dv">7</span><span class="ot">,</span><span class="dv">8</span><span class="ot">,</span><span class="dv">9</span><span class="ot">}</span> <span class="kw">do</span>
    <span class="kw">a</span> <span class="ot">=</span> <span class="kw">k</span> <span class="ot">+</span> <span class="kw">v</span>       <span class="co">-- executes 10 times (at end a == 10 + 9)</span>
<span class="kw">end</span></code></pre>
</dd>
</dl>
</div><div class="section slide level2" id="extensibility-meta-table">
<h1>Extensibility (Meta table)</h1>
<ul class="incremental">
<li>Can extend tables and userdata using meta tables</li>
<li>Meta table is a plain <em>Lua</em> table</li>
<li>Meta table bound to userdata or table using <code>setmetatable(t, mt)</code> function</li>
<li>Inserting functions at specific keys specialize behaviour
<ul class="incremental">
<li>Arithmetic : <code>__add</code>, <code>__sub</code> etc.</li>
<li>Comparison : <code>__eq</code>, <code>__lt</code> and <code>__le</code>.</li>
<li>Key lookup and new key insertion : <code>__index</code> and <code>__newindex</code></li>
<li>Function call (using object as a function): <code>__call</code></li>
<li>Finalizers : <code>__gc</code> must be set from <em>C</em></li>
</ul></li>
</ul>
</div><div class="section slide level2" id="metatable-example">
<h1>Metatable example</h1>
<ul>
<li>Fibber object based on some number <code>n</code></li>
<li>Fibbers can be added or subtracked</li>
<li>Can't add any values to fibbers</li>
<li>Applying function call to fibbers returns n_th fibonacci number</li>
</ul>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">mtFibber</span> <span class="ot">=</span> <span class="ot">{}</span>
<span class="kw">function</span> makeFibber<span class="ot">(</span><span class="kw">n</span><span class="ot">)</span>
    <span class="kw">local</span> <span class="kw">f</span> <span class="ot">=</span> <span class="ot">{</span><span class="kw">n</span> <span class="ot">=</span> <span class="kw">n</span><span class="ot">}</span>
    <span class="fu">setmetatable</span><span class="ot">(</span><span class="kw">f</span><span class="ot">,</span> <span class="kw">mtFibber</span><span class="ot">)</span>
    <span class="kw">return</span> <span class="kw">f</span>
<span class="kw">end</span>
<span class="kw">do</span>
    <span class="kw">function</span> <span class="kw">mtFibber</span>:__call<span class="ot">()</span>
        <span class="kw">local</span> <span class="kw">n</span> <span class="ot">=</span> <span class="fu">math.max</span><span class="ot">(</span><span class="kw">self</span><span class="ot">.</span><span class="kw">n</span><span class="ot">,</span><span class="dv">0</span><span class="ot">)</span>
        <span class="kw">local</span> <span class="kw">function</span> _fib<span class="ot">(</span><span class="kw">fn2</span><span class="ot">,</span> <span class="kw">fn1</span><span class="ot">,</span> <span class="kw">at</span><span class="ot">)</span>
            <span class="kw">if</span> <span class="kw">at</span> <span class="ot">==</span> <span class="kw">n</span> <span class="kw">then</span> 
                <span class="kw">return</span> <span class="kw">fn1</span> <span class="ot">+</span> <span class="kw">fn2</span>
            <span class="kw">else</span>
                <span class="kw">return</span> _fib<span class="ot">(</span><span class="kw">fn1</span><span class="ot">,</span> <span class="kw">fn1</span> <span class="ot">+</span> <span class="kw">fn2</span><span class="ot">,</span> <span class="kw">at</span><span class="ot">+</span><span class="dv">1</span><span class="ot">)</span>
            <span class="kw">end</span>
        <span class="kw">end</span>
        <span class="kw">if</span> <span class="kw">n</span> <span class="ot">&lt;=</span> <span class="dv">0</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">0</span>
        <span class="kw">elseif</span> <span class="kw">n</span> <span class="ot">==</span> <span class="dv">1</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">1</span>
        <span class="kw">else</span> <span class="kw">return</span> _fib<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span> <span class="kw">end</span>
    <span class="kw">end</span>
    <span class="kw">function</span> <span class="kw">mtFibber</span><span class="ot">.</span>__add<span class="ot">(</span><span class="kw">lhs</span><span class="ot">,</span> <span class="kw">rhs</span><span class="ot">)</span> <span class="kw">return</span> makeFibber<span class="ot">(</span><span class="kw">lhs</span><span class="ot">.</span><span class="kw">n</span> <span class="ot">+</span> <span class="kw">rhs</span><span class="ot">.</span><span class="kw">n</span><span class="ot">)</span> <span class="kw">end</span>
    <span class="kw">function</span> <span class="kw">mtFibber</span><span class="ot">.</span>__sub<span class="ot">(</span><span class="kw">lhs</span><span class="ot">,</span> <span class="kw">rhs</span><span class="ot">)</span> <span class="kw">return</span> makeFibber<span class="ot">(</span><span class="kw">lhs</span><span class="ot">.</span><span class="kw">n</span> <span class="ot">-</span> <span class="kw">rhs</span><span class="ot">.</span><span class="kw">n</span><span class="ot">)</span> <span class="kw">end</span>
    <span class="kw">function</span> <span class="kw">mtFibber</span>:__newindex<span class="ot">(</span><span class="kw">k</span><span class="ot">,</span><span class="kw">v</span><span class="ot">)</span> <span class="fu">assert</span><span class="ot">(</span><span class="kw">false</span><span class="ot">,</span> <span class="st">&quot;can&#39;t add members&quot;</span><span class="ot">)</span> <span class="kw">end</span>
<span class="kw">end</span>
<span class="kw">local</span> <span class="kw">f1</span> <span class="ot">=</span> makeFibber<span class="ot">(</span><span class="dv">10</span><span class="ot">)</span>
<span class="kw">local</span> <span class="kw">f2</span> <span class="ot">=</span> makeFibber<span class="ot">(</span><span class="dv">5</span><span class="ot">)</span>
<span class="kw">local</span> <span class="kw">f3</span> <span class="ot">=</span> makeFibber<span class="ot">(</span><span class="dv">100</span><span class="ot">)</span>
<span class="kw">local</span> <span class="kw">f4</span> <span class="ot">=</span> <span class="ot">(</span><span class="kw">f3</span> <span class="ot">+</span> <span class="kw">f2</span> <span class="ot">-</span> <span class="kw">f1</span><span class="ot">)</span>
<span class="co">-- The 95th fibonacci is 3.194043463499e+019</span>
<span class="fu">print</span> <span class="ot">(</span><span class="st">&quot;The &quot;</span> <span class="ot">..</span> <span class="kw">f4</span><span class="ot">.</span><span class="kw">n</span> <span class="ot">..</span> <span class="st">&quot;nth fibonacci number is &quot;</span> <span class="ot">..</span> f4<span class="ot">())</span></code></pre>
</div>
</body>
</html>
